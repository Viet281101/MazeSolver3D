var st=Object.defineProperty;var ot=(u,t,s)=>t in u?st(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s;var a=(u,t,s)=>ot(u,typeof t!="symbol"?t+"":t,s);import{R as nt,P as at,E as rt,V as b,M as N,T as A,Q as Le,S as xe,a as v,b as lt,c as ht,D as ct,F as dt,B as ut,d as pt,L as mt,e as He,f as $,g as Z,h as gt,G as ae,C as De,i as ft,j as wt,W as yt,O as Fe}from"./three-CcvySZ3Z.js";import{G as bt}from"./datgui-DYGKXP-V.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const Re={type:"change"},oe={type:"start"},Te={type:"end"},K=new nt,ke=new at,Ct=Math.cos(70*lt.DEG2RAD);class vt extends rt{constructor(t,s){super(),this.object=t,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new b,this.cursor=new b,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.PAN},this.touches={ONE:A.ROTATE,TWO:A.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return h.phi},this.getAzimuthalAngle=function(){return h.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(i){i.addEventListener("keydown",se),this._domElementKeyEvents=i},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",se),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Re),e.update(),n=o.NONE},this.update=function(){const i=new b,r=new Le().setFromUnitVectors(t.up,new b(0,1,0)),c=r.clone().invert(),p=new b,y=new Le,S=new b,C=2*Math.PI;return function(it=null){const Se=e.object.position;i.copy(Se).sub(e.target),i.applyQuaternion(r),h.setFromVector3(i),e.autoRotate&&n===o.NONE&&j(Ae(it)),e.enableDamping?(h.theta+=d.theta*e.dampingFactor,h.phi+=d.phi*e.dampingFactor):(h.theta+=d.theta,h.phi+=d.phi);let E=e.minAzimuthAngle,M=e.maxAzimuthAngle;isFinite(E)&&isFinite(M)&&(E<-Math.PI?E+=C:E>Math.PI&&(E-=C),M<-Math.PI?M+=C:M>Math.PI&&(M-=C),E<=M?h.theta=Math.max(E,Math.min(M,h.theta)):h.theta=h.theta>(E+M)/2?Math.max(E,h.theta):Math.min(M,h.theta)),h.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,h.phi)),h.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(g,e.dampingFactor):e.target.add(g),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let X=!1;if(e.zoomToCursor&&U||e.object.isOrthographicCamera)h.radius=te(h.radius);else{const z=h.radius;h.radius=te(h.radius*m),X=z!=h.radius}if(i.setFromSpherical(h),i.applyQuaternion(c),Se.copy(e.target).add(i),e.object.lookAt(e.target),e.enableDamping===!0?(d.theta*=1-e.dampingFactor,d.phi*=1-e.dampingFactor,g.multiplyScalar(1-e.dampingFactor)):(d.set(0,0,0),g.set(0,0,0)),e.zoomToCursor&&U){let z=null;if(e.object.isPerspectiveCamera){const G=i.length();z=te(G*m);const q=G-z;e.object.position.addScaledVector(re,q),e.object.updateMatrixWorld(),X=!!q}else if(e.object.isOrthographicCamera){const G=new b(P.x,P.y,0);G.unproject(e.object);const q=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),X=q!==e.object.zoom;const Oe=new b(P.x,P.y,0);Oe.unproject(e.object),e.object.position.sub(Oe).add(G),e.object.updateMatrixWorld(),z=i.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;z!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(z).add(e.object.position):(K.origin.copy(e.object.position),K.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(K.direction))<Ct?t.lookAt(e.target):(ke.setFromNormalAndCoplanarPoint(e.object.up,e.target),K.intersectPlane(ke,e.target))))}else if(e.object.isOrthographicCamera){const z=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),z!==e.object.zoom&&(e.object.updateProjectionMatrix(),X=!0)}return m=1,U=!1,X||p.distanceToSquared(e.object.position)>l||8*(1-y.dot(e.object.quaternion))>l||S.distanceToSquared(e.target)>l?(e.dispatchEvent(Re),p.copy(e.object.position),y.copy(e.object.quaternion),S.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",ze),e.domElement.removeEventListener("pointerdown",be),e.domElement.removeEventListener("pointercancel",Y),e.domElement.removeEventListener("wheel",Ce),e.domElement.removeEventListener("pointermove",ie),e.domElement.removeEventListener("pointerup",Y),e.domElement.getRootNode().removeEventListener("keydown",ve,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",se),e._domElementKeyEvents=null)};const e=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=o.NONE;const l=1e-6,h=new xe,d=new xe;let m=1;const g=new b,f=new v,O=new v,R=new v,L=new v,x=new v,T=new v,k=new v,I=new v,D=new v,re=new b,P=new v;let U=!1;const w=[],W={};let Q=!1;function Ae(i){return i!==null?2*Math.PI/60*e.autoRotateSpeed*i:2*Math.PI/60/60*e.autoRotateSpeed}function B(i){const r=Math.abs(i*.01);return Math.pow(.95,e.zoomSpeed*r)}function j(i){d.theta-=i}function _(i){d.phi-=i}const le=function(){const i=new b;return function(c,p){i.setFromMatrixColumn(p,0),i.multiplyScalar(-c),g.add(i)}}(),he=function(){const i=new b;return function(c,p){e.screenSpacePanning===!0?i.setFromMatrixColumn(p,1):(i.setFromMatrixColumn(p,0),i.crossVectors(e.object.up,i)),i.multiplyScalar(c),g.add(i)}}(),H=function(){const i=new b;return function(c,p){const y=e.domElement;if(e.object.isPerspectiveCamera){const S=e.object.position;i.copy(S).sub(e.target);let C=i.length();C*=Math.tan(e.object.fov/2*Math.PI/180),le(2*c*C/y.clientHeight,e.object.matrix),he(2*p*C/y.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(le(c*(e.object.right-e.object.left)/e.object.zoom/y.clientWidth,e.object.matrix),he(p*(e.object.top-e.object.bottom)/e.object.zoom/y.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function J(i){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?m/=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ce(i){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?m*=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ee(i,r){if(!e.zoomToCursor)return;U=!0;const c=e.domElement.getBoundingClientRect(),p=i-c.left,y=r-c.top,S=c.width,C=c.height;P.x=p/S*2-1,P.y=-(y/C)*2+1,re.set(P.x,P.y,1).unproject(e.object).sub(e.object.position).normalize()}function te(i){return Math.max(e.minDistance,Math.min(e.maxDistance,i))}function de(i){f.set(i.clientX,i.clientY)}function We(i){ee(i.clientX,i.clientX),k.set(i.clientX,i.clientY)}function ue(i){L.set(i.clientX,i.clientY)}function je(i){O.set(i.clientX,i.clientY),R.subVectors(O,f).multiplyScalar(e.rotateSpeed);const r=e.domElement;j(2*Math.PI*R.x/r.clientHeight),_(2*Math.PI*R.y/r.clientHeight),f.copy(O),e.update()}function Ye(i){I.set(i.clientX,i.clientY),D.subVectors(I,k),D.y>0?J(B(D.y)):D.y<0&&ce(B(D.y)),k.copy(I),e.update()}function Xe(i){x.set(i.clientX,i.clientY),T.subVectors(x,L).multiplyScalar(e.panSpeed),H(T.x,T.y),L.copy(x),e.update()}function Ge(i){ee(i.clientX,i.clientY),i.deltaY<0?ce(B(i.deltaY)):i.deltaY>0&&J(B(i.deltaY)),e.update()}function Ve(i){let r=!1;switch(i.code){case e.keys.UP:i.ctrlKey||i.metaKey||i.shiftKey?_(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):H(0,e.keyPanSpeed),r=!0;break;case e.keys.BOTTOM:i.ctrlKey||i.metaKey||i.shiftKey?_(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):H(0,-e.keyPanSpeed),r=!0;break;case e.keys.LEFT:i.ctrlKey||i.metaKey||i.shiftKey?j(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):H(e.keyPanSpeed,0),r=!0;break;case e.keys.RIGHT:i.ctrlKey||i.metaKey||i.shiftKey?j(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):H(-e.keyPanSpeed,0),r=!0;break}r&&(i.preventDefault(),e.update())}function pe(i){if(w.length===1)f.set(i.pageX,i.pageY);else{const r=F(i),c=.5*(i.pageX+r.x),p=.5*(i.pageY+r.y);f.set(c,p)}}function me(i){if(w.length===1)L.set(i.pageX,i.pageY);else{const r=F(i),c=.5*(i.pageX+r.x),p=.5*(i.pageY+r.y);L.set(c,p)}}function ge(i){const r=F(i),c=i.pageX-r.x,p=i.pageY-r.y,y=Math.sqrt(c*c+p*p);k.set(0,y)}function Ue(i){e.enableZoom&&ge(i),e.enablePan&&me(i)}function Be(i){e.enableZoom&&ge(i),e.enableRotate&&pe(i)}function fe(i){if(w.length==1)O.set(i.pageX,i.pageY);else{const c=F(i),p=.5*(i.pageX+c.x),y=.5*(i.pageY+c.y);O.set(p,y)}R.subVectors(O,f).multiplyScalar(e.rotateSpeed);const r=e.domElement;j(2*Math.PI*R.x/r.clientHeight),_(2*Math.PI*R.y/r.clientHeight),f.copy(O)}function we(i){if(w.length===1)x.set(i.pageX,i.pageY);else{const r=F(i),c=.5*(i.pageX+r.x),p=.5*(i.pageY+r.y);x.set(c,p)}T.subVectors(x,L).multiplyScalar(e.panSpeed),H(T.x,T.y),L.copy(x)}function ye(i){const r=F(i),c=i.pageX-r.x,p=i.pageY-r.y,y=Math.sqrt(c*c+p*p);I.set(0,y),D.set(0,Math.pow(I.y/k.y,e.zoomSpeed)),J(D.y),k.copy(I);const S=(i.pageX+r.x)*.5,C=(i.pageY+r.y)*.5;ee(S,C)}function _e(i){e.enableZoom&&ye(i),e.enablePan&&we(i)}function qe(i){e.enableZoom&&ye(i),e.enableRotate&&fe(i)}function be(i){e.enabled!==!1&&(w.length===0&&(e.domElement.setPointerCapture(i.pointerId),e.domElement.addEventListener("pointermove",ie),e.domElement.addEventListener("pointerup",Y)),!tt(i)&&(Je(i),i.pointerType==="touch"?Me(i):Ke(i)))}function ie(i){e.enabled!==!1&&(i.pointerType==="touch"?Qe(i):$e(i))}function Y(i){switch(et(i),w.length){case 0:e.domElement.releasePointerCapture(i.pointerId),e.domElement.removeEventListener("pointermove",ie),e.domElement.removeEventListener("pointerup",Y),e.dispatchEvent(Te),n=o.NONE;break;case 1:const r=w[0],c=W[r];Me({pointerId:r,pageX:c.x,pageY:c.y});break}}function Ke(i){let r;switch(i.button){case 0:r=e.mouseButtons.LEFT;break;case 1:r=e.mouseButtons.MIDDLE;break;case 2:r=e.mouseButtons.RIGHT;break;default:r=-1}switch(r){case N.DOLLY:if(e.enableZoom===!1)return;We(i),n=o.DOLLY;break;case N.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(e.enablePan===!1)return;ue(i),n=o.PAN}else{if(e.enableRotate===!1)return;de(i),n=o.ROTATE}break;case N.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(e.enableRotate===!1)return;de(i),n=o.ROTATE}else{if(e.enablePan===!1)return;ue(i),n=o.PAN}break;default:n=o.NONE}n!==o.NONE&&e.dispatchEvent(oe)}function $e(i){switch(n){case o.ROTATE:if(e.enableRotate===!1)return;je(i);break;case o.DOLLY:if(e.enableZoom===!1)return;Ye(i);break;case o.PAN:if(e.enablePan===!1)return;Xe(i);break}}function Ce(i){e.enabled===!1||e.enableZoom===!1||n!==o.NONE||(i.preventDefault(),e.dispatchEvent(oe),Ge(Ze(i)),e.dispatchEvent(Te))}function Ze(i){const r=i.deltaMode,c={clientX:i.clientX,clientY:i.clientY,deltaY:i.deltaY};switch(r){case 1:c.deltaY*=16;break;case 2:c.deltaY*=100;break}return i.ctrlKey&&!Q&&(c.deltaY*=10),c}function ve(i){i.key==="Control"&&(Q=!0,e.domElement.getRootNode().addEventListener("keyup",Ee,{passive:!0,capture:!0}))}function Ee(i){i.key==="Control"&&(Q=!1,e.domElement.getRootNode().removeEventListener("keyup",Ee,{passive:!0,capture:!0}))}function se(i){e.enabled===!1||e.enablePan===!1||Ve(i)}function Me(i){switch(Pe(i),w.length){case 1:switch(e.touches.ONE){case A.ROTATE:if(e.enableRotate===!1)return;pe(i),n=o.TOUCH_ROTATE;break;case A.PAN:if(e.enablePan===!1)return;me(i),n=o.TOUCH_PAN;break;default:n=o.NONE}break;case 2:switch(e.touches.TWO){case A.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ue(i),n=o.TOUCH_DOLLY_PAN;break;case A.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Be(i),n=o.TOUCH_DOLLY_ROTATE;break;default:n=o.NONE}break;default:n=o.NONE}n!==o.NONE&&e.dispatchEvent(oe)}function Qe(i){switch(Pe(i),n){case o.TOUCH_ROTATE:if(e.enableRotate===!1)return;fe(i),e.update();break;case o.TOUCH_PAN:if(e.enablePan===!1)return;we(i),e.update();break;case o.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;_e(i),e.update();break;case o.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;qe(i),e.update();break;default:n=o.NONE}}function ze(i){e.enabled!==!1&&i.preventDefault()}function Je(i){w.push(i.pointerId)}function et(i){delete W[i.pointerId];for(let r=0;r<w.length;r++)if(w[r]==i.pointerId){w.splice(r,1);return}}function tt(i){for(let r=0;r<w.length;r++)if(w[r]==i.pointerId)return!0;return!1}function Pe(i){let r=W[i.pointerId];r===void 0&&(r=new v,W[i.pointerId]=r),r.set(i.pageX,i.pageY)}function F(i){const r=i.pointerId===w[0]?w[1]:w[0];return W[r]}e.domElement.addEventListener("contextmenu",ze),e.domElement.addEventListener("pointerdown",be),e.domElement.addEventListener("pointercancel",Y),e.domElement.addEventListener("wheel",Ce,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",ve,{passive:!0,capture:!0}),this.update()}}class Et{constructor(){a(this,"materials",new Map);a(this,"geometries",new Map);a(this,"edgeGeometries",new Map);a(this,"edgeMaterial",null)}getMaterial(t,s,e,o){const n=`${t}-${s}`;if(!this.materials.has(n)){const h=new ht({color:e.clone(),transparent:o<1,opacity:o,side:s==="floor"?ct:dt});this.materials.set(n,h)}const l=this.materials.get(n);return l.color.copy(e),l.opacity=o,l.transparent=o<1,l}getBoxGeometry(t,s,e){const o=`box-${t}-${s}-${e}`;return this.geometries.has(o)||this.geometries.set(o,new ut(t,s,e)),this.geometries.get(o)}getPlaneGeometry(t,s){const e=`plane-${t}-${s}`;return this.geometries.has(e)||this.geometries.set(e,new pt(t,s)),this.geometries.get(e)}getEdgeMaterial(){return this.edgeMaterial||(this.edgeMaterial=new mt({color:0,transparent:!0,opacity:.9,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1})),this.edgeMaterial}getEdgesGeometry(t){const s=`edges-${t.uuid}`;return this.edgeGeometries.has(s)||this.edgeGeometries.set(s,new He(t)),this.edgeGeometries.get(s)}updateMaterialColor(t,s){this.materials.forEach((e,o)=>{(o.endsWith(`-${t}`)||o.includes(`-${t}-`))&&e.color.copy(s)})}updateMaterialOpacity(t,s){this.materials.forEach((e,o)=>{if(o.endsWith(`-${t}`)||o.includes(`-${t}-`)){const n=e,l=n.transparent;n.opacity=s,n.transparent=s<1,n.transparent!==l&&(n.needsUpdate=!0)}})}dispose(){this.materials.forEach(t=>{t.dispose()}),this.materials.clear(),this.geometries.forEach(t=>{t.dispose()}),this.geometries.clear(),this.edgeGeometries.forEach(t=>{t.dispose()}),this.edgeGeometries.clear(),this.edgeMaterial&&(this.edgeMaterial.dispose(),this.edgeMaterial=null)}clearMaterialCache(){this.materials.forEach(t=>t.dispose()),this.materials.clear()}}class ne{static disposeObject(t){t instanceof $?this.disposeMesh(t):(t instanceof Z||t instanceof gt)&&this.disposeLine(t),[...t.children].forEach(e=>{this.disposeObject(e),t.remove(e)})}static disposeMesh(t){t.geometry&&!t.userData.sharedGeometry&&t.geometry.dispose(),t.material&&!t.userData.sharedMaterial&&this.disposeMaterial(t.material)}static disposeLine(t){t.geometry&&!t.userData.sharedGeometry&&t.geometry.dispose(),t.material&&!t.userData.sharedMaterial&&this.disposeMaterial(t.material)}static disposeMaterial(t){Array.isArray(t)?t.forEach(s=>s.dispose()):t.dispose()}static disposeScene(t){[...t.children].forEach(e=>{this.disposeObject(e),t.remove(e)})}static disposeGroup(t){[...t.children].forEach(e=>{this.disposeObject(e),t.remove(e)})}static disposeEdgesFromGroup(t){const s=[];return t.children.forEach(e=>{e instanceof Z&&(s.push(e),this.disposeLine(e))}),s.forEach(e=>t.remove(e)),s}}class Mt{constructor(t,s,e,o,n,l){this.resourceManager=t,this.wallColor=s,this.floorColor=e,this.wallOpacity=o,this.floorOpacity=n,this.showEdges=l}createWall(t){const{x:s,y:e,z:o,width:n,height:l,depth:h}=t,d=this.resourceManager.getBoxGeometry(n,l,h),m=this.resourceManager.getMaterial("wall","wall",this.wallColor,this.wallOpacity),g=new $(d,m);g.position.set(s,e,o),g.userData.sharedGeometry=!0,g.userData.sharedMaterial=!0;const f=new ae;return f.add(g),this.showEdges&&this.addEdgesToGroup(f,d,s,e,o),f}createFloor(t){const{x:s,y:e,z:o,width:n,height:l,rotationX:h=-Math.PI/2}=t,d=this.resourceManager.getPlaneGeometry(n,l),m=this.resourceManager.getMaterial("floor","floor",this.floorColor,this.floorOpacity),g=new $(d,m);g.rotation.x=h,g.position.set(s,e,o),g.userData.sharedGeometry=!0,g.userData.sharedMaterial=!0;const f=new ae;return f.add(g),this.showEdges&&this.addEdgesToGroup(f,d,s,e,o,h),f}createSmallFloor(t,s,e,o){return this.createFloor({x:t,y:s,z:e,width:o,height:o,rotationX:-Math.PI/2})}addEdgesToGroup(t,s,e,o,n,l=0){const h=this.resourceManager.getEdgesGeometry(s),d=this.resourceManager.getEdgeMaterial(),m=new Z(h,d);m.position.set(e,o,n),m.rotation.x=l,m.renderOrder=1,m.userData.sharedGeometry=!0,m.userData.sharedMaterial=!0,t.add(m)}updateSettings(t){t.wallColor&&(this.wallColor=t.wallColor),t.floorColor&&(this.floorColor=t.floorColor),t.wallOpacity!==void 0&&(this.wallOpacity=t.wallOpacity),t.floorOpacity!==void 0&&(this.floorOpacity=t.floorOpacity),t.showEdges!==void 0&&(this.showEdges=t.showEdges)}}class Ne{constructor(t,s,e={}){a(this,"canvas");a(this,"scene");a(this,"camera");a(this,"renderer");a(this,"controls");a(this,"maze");a(this,"mazeLayers",[]);a(this,"wallHeight");a(this,"wallThickness");a(this,"cellSize");a(this,"wallColor");a(this,"floorColor");a(this,"wallOpacity");a(this,"floorOpacity");a(this,"showEdges");a(this,"resourceManager");a(this,"meshFactory");a(this,"animationId",null);a(this,"needsRender",!0);a(this,"isRendering",!1);a(this,"isDisposed",!1);a(this,"renderListeners",new Set);this.canvas=t,this.maze=s,this.wallHeight=e.wallHeight??1,this.wallThickness=e.wallThickness??.1,this.cellSize=e.cellSize??1,this.wallColor=new De(8421504),this.floorColor=new De(12632256),this.wallOpacity=1,this.floorOpacity=1,this.showEdges=!0,this.scene=new ft,this.camera=new wt(75,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new yt({canvas:this.canvas,antialias:!0,powerPreference:"high-performance"}),this.controls=new vt(this.camera,this.renderer.domElement),this.resourceManager=new Et,this.meshFactory=new Mt(this.resourceManager,this.wallColor,this.floorColor,this.wallOpacity,this.floorOpacity,this.showEdges),this.init()}init(){const{width:t,height:s,pixelRatio:e}=this.getRendererSize();this.renderer.setPixelRatio(e),this.renderer.setSize(t,s),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.addEventListener("change",()=>this.requestRender()),this.createMaze(),this.requestRender()}positionCamera(t,s,e){this.camera.position.set(t,10,e),this.controls.target.set(t,0,s),this.controls.update()}requestRender(){this.isDisposed||(this.needsRender=!0,!this.isRendering&&(this.isRendering=!0,this.animationId=requestAnimationFrame(()=>{if(this.isDisposed){this.isRendering=!1;return}if(!this.needsRender){this.isRendering=!1;return}this.needsRender=!1;const t=this.controls.update();this.renderer.render(this.scene,this.camera),this.renderListeners.forEach(s=>s()),this.isRendering=!1,(t||this.needsRender)&&this.requestRender()})))}stopAnimation(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}resize(){if(this.isDisposed)return;this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();const{width:t,height:s,pixelRatio:e}=this.getRendererSize();this.renderer.setPixelRatio(e),this.renderer.setSize(t,s),this.requestRender()}deleteMaze(){this.mazeLayers.forEach(t=>{ne.disposeObject(t),this.scene.remove(t)}),this.mazeLayers=[]}destroy(){this.isDisposed||(this.isDisposed=!0,this.stopAnimation(),this.deleteMaze(),this.controls.dispose(),this.resourceManager.dispose(),ne.disposeScene(this.scene),this.renderer.dispose())}getRenderer(){return this.renderer}updateWallColor(t){this.wallColor.set(t),this.resourceManager.updateMaterialColor("wall",this.wallColor),this.meshFactory.updateSettings({wallColor:this.wallColor}),this.requestRender()}updateFloorColor(t){this.floorColor.set(t),this.resourceManager.updateMaterialColor("floor",this.floorColor),this.meshFactory.updateSettings({floorColor:this.floorColor}),this.requestRender()}updateWallOpacity(t){this.wallOpacity=t,this.resourceManager.updateMaterialOpacity("wall",t),this.meshFactory.updateSettings({wallOpacity:t}),this.requestRender()}updateFloorOpacity(t){this.floorOpacity=t,this.resourceManager.updateMaterialOpacity("floor",t),this.meshFactory.updateSettings({floorOpacity:t}),this.requestRender()}toggleEdges(t){this.showEdges!==t&&(this.showEdges=t,this.meshFactory.updateSettings({showEdges:t}),this.rebuildEdges(),this.requestRender())}addRenderListener(t){this.renderListeners.add(t)}removeRenderListener(t){this.renderListeners.delete(t)}rebuildEdges(){this.mazeLayers.forEach(t=>{t.children.forEach(s=>{s instanceof ae&&(ne.disposeEdgesFromGroup(s),this.showEdges&&s.children.forEach(e=>{if(e instanceof $){const o=new He(e.geometry),n=this.resourceManager.getEdgeMaterial(),l=new Z(o,n);l.position.copy(e.position),l.rotation.copy(e.rotation),s.add(l)}}))})}),this.requestRender()}getRendererSize(){const t=Math.min(window.devicePixelRatio,1.5),s=this.renderer.capabilities.maxTextureSize,e=Math.floor(s/t),o=Math.min(window.innerWidth,e),n=Math.min(window.innerHeight,e);return{width:o,height:n,pixelRatio:t}}}class Ie extends Ne{constructor(t,s,e){super(t,s,e)}createMaze(){this.deleteMaze();const t=new Fe,s=this.maze[0];this.createWalls(s,t),this.createMainFloor(s,t),this.mazeLayers.push(t),this.scene.add(t),this.positionCameraForMaze(s)}createWalls(t,s){t.forEach((e,o)=>{e.forEach((n,l)=>{if(n===1){if(l<e.length-1&&e[l+1]===1){const h=this.meshFactory.createWall({x:l*this.cellSize+this.cellSize/2,y:this.wallHeight/2,z:-o*this.cellSize,width:this.cellSize,height:this.wallHeight,depth:this.wallThickness});s.add(h)}if(o<t.length-1&&t[o+1][l]===1){const h=this.meshFactory.createWall({x:l*this.cellSize,y:this.wallHeight/2,z:-(o*this.cellSize+this.cellSize/2),width:this.wallThickness,height:this.wallHeight,depth:this.cellSize});s.add(h)}}})})}createMainFloor(t,s){const e=t[0].length*this.cellSize,o=t.length*this.cellSize,n=this.meshFactory.createFloor({x:e/2-this.cellSize/2,y:-this.wallThickness/2,z:-(o/2)+this.cellSize/2,width:e,height:o});s.add(n)}positionCameraForMaze(t){const s=t[0].length*this.cellSize/2-this.cellSize/2,e=-(t.length*this.cellSize)/2+this.cellSize/2,o=t.length*this.cellSize;this.positionCamera(s,e,o)}}class zt extends Ne{constructor(t,s,e){super(t,s,e)}createMaze(){this.deleteMaze(),this.maze.forEach((t,s)=>{const e=new Fe,o=s*this.wallHeight;this.createWallsForLayer(t,o,e),s>0?this.createLayerFloors(t,o,e):this.createMainFloor(t,e),this.mazeLayers.push(e),this.scene.add(e)}),this.positionCameraForMultiLayer()}createWallsForLayer(t,s,e){t.forEach((o,n)=>{o.forEach((l,h)=>{if(l===1){if(h<o.length-1&&o[h+1]===1){const d=this.meshFactory.createWall({x:h*this.cellSize+this.cellSize/2,y:s+this.wallHeight/2,z:-n*this.cellSize,width:this.cellSize,height:this.wallHeight,depth:this.wallThickness});e.add(d)}if(n<t.length-1&&t[n+1][h]===1){const d=this.meshFactory.createWall({x:h*this.cellSize,y:s+this.wallHeight/2,z:-(n*this.cellSize+this.cellSize/2),width:this.wallThickness,height:this.wallHeight,depth:this.cellSize});e.add(d)}}})})}createLayerFloors(t,s,e){t.forEach((o,n)=>{o.forEach((l,h)=>{if(l!==2){const d=this.meshFactory.createSmallFloor(h*this.cellSize,s,-n*this.cellSize,this.cellSize);e.add(d)}})})}createMainFloor(t,s){const e=t[0].length*this.cellSize,o=t.length*this.cellSize,n=this.meshFactory.createFloor({x:e/2-this.cellSize/2,y:-this.wallThickness/2,z:-(o/2)+this.cellSize/2,width:e,height:o});s.add(n)}positionCameraForMultiLayer(){const t=this.maze[0],s=t[0].length*this.cellSize/2-this.cellSize/2,e=-(t.length*this.cellSize)/2+this.cellSize/2,o=this.maze.length*this.cellSize;this.positionCamera(s,e,o)}}function Pt(u){const s=u.createPopupContainer("solvePopup","Solve Maze").querySelector("canvas"),e=s.getContext("2d");e&&(e.fillStyle="#a0a0a0",e.fillRect(0,0,s.width,s.height))}function St(u){const s=u.createPopupContainer("settingsPopup","Settings").querySelector("canvas"),e=s.getContext("2d");e&&(e.fillStyle="#a0a0a0",e.fillRect(0,0,s.width,s.height))}function Ot(u){const s=u.createPopupContainer("tutorialPopup","Tutorial").querySelector("canvas"),e=s.getContext("2d");e&&(e.fillStyle="#a0a0a0",e.fillRect(0,0,s.width,s.height))}function Lt(u){const s=u.createPopupContainer("mazePopup","Custom Maze").querySelector("canvas"),e=s.getContext("2d",{alpha:!1,desynchronized:!0});if(!e){console.error("Failed to get 2D context for maze popup");return}e.fillStyle="#a0a0a0",e.fillRect(0,0,s.width,s.height)}class xt{constructor(){a(this,"canvas");a(this,"ctx");a(this,"isMobile");a(this,"buttons");a(this,"popupOpen");a(this,"currentPopup");a(this,"currentCloseIcon");a(this,"mouseMoveHandler");a(this,"mouseDownHandler");a(this,"touchStartHandler");a(this,"documentClickHandler");a(this,"imageCache",new Map);a(this,"imagesLoaded",!1);this.isMobile=this.checkIfMobile(),this.setupCanvas(),this.buttons=this.createButtons(),this.popupOpen=!1,this.currentPopup=null,this.currentCloseIcon=null,this.preloadImages().then(()=>{this.imagesLoaded=!0,this.drawToolbar()}),this.addEventListeners()}checkIfMobile(){return window.innerWidth<=800}setupCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.canvas.className="toolbar-canvas"),this.canvas.parentNode||document.body.appendChild(this.canvas),this.canvas.width=this.isMobile?window.innerWidth:50,this.canvas.height=this.isMobile?50:window.innerHeight}createButtons(){const t=["/MazeSolver3D/icon/maze.png","/MazeSolver3D/icon/solving.png","/MazeSolver3D/icon/question.png","/MazeSolver3D/icon/setting.png"];return[{name:"Custom Maze",icon:t[0],action:()=>this.togglePopup("maze"),x:0,y:0,width:0,height:0},{name:"Solving Maze",icon:t[1],action:()=>this.togglePopup("solve"),x:0,y:0,width:0,height:0},{name:"Tutorial",icon:t[2],action:()=>this.togglePopup("tutorial"),x:0,y:0,width:0,height:0},{name:"Settings",icon:t[3],action:()=>this.togglePopup("settings"),x:0,y:0,width:0,height:0}]}async preloadImages(){const t=this.buttons.map(s=>new Promise((e,o)=>{if(this.imageCache.has(s.icon)){s.image=this.imageCache.get(s.icon),e();return}const n=new Image;n.onload=()=>{this.imageCache.set(s.icon,n),s.image=n,e()},n.onerror=()=>{console.error(`Failed to load icon: ${s.icon}`),o(new Error(`Failed to load ${s.icon}`))},n.src=s.icon}));try{await Promise.all(t)}catch(s){console.error("Error loading toolbar icons:",s)}}drawToolbar(){this.imagesLoaded&&(this.ctx.fillStyle="#333",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.isMobile?this.drawToolbarVertical():this.drawToolbarHorizontal())}drawToolbarVertical(){const o=this.buttons.length*60;let n=(this.canvas.width-o)/2;this.buttons.forEach(l=>{l.image&&(this.ctx.drawImage(l.image,n-2,8,36,36),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.strokeRect(n-5,5,40,40),l.x=n-5,l.y=5,l.width=40,l.height=40),n+=60})}drawToolbarHorizontal(){const o=this.buttons.length*60;let n=(this.canvas.height-o)/2;this.buttons.forEach(l=>{l.image&&(this.ctx.drawImage(l.image,8,n-2,36,36),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.strokeRect(5,n-5,40,40),l.x=5,l.y=n-5,l.width=40,l.height=40),n+=60})}addEventListeners(){this.removeEventListeners(),this.mouseMoveHandler=t=>{let s="default";for(const e of this.buttons)if(this.isInside(t.clientX,t.clientY,e)){s="pointer";break}this.canvas.style.cursor=s},this.canvas.addEventListener("mousemove",this.mouseMoveHandler,{passive:!0}),this.mouseDownHandler=t=>this.handleCanvasClick(t),this.touchStartHandler=t=>this.handleCanvasClick(t),this.canvas.addEventListener("mousedown",this.mouseDownHandler),this.canvas.addEventListener("touchstart",this.touchStartHandler,{passive:!0}),this.documentClickHandler=t=>this.handleDocumentClick(t),document.addEventListener("click",this.documentClickHandler,{passive:!0}),document.addEventListener("touchstart",this.documentClickHandler,{passive:!0})}removeEventListeners(){this.mouseMoveHandler&&this.canvas.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseDownHandler&&this.canvas.removeEventListener("mousedown",this.mouseDownHandler),this.touchStartHandler&&this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.documentClickHandler&&(document.removeEventListener("click",this.documentClickHandler),document.removeEventListener("touchstart",this.documentClickHandler))}handleCanvasClick(t){const s="clientX"in t?t.clientX:t.touches[0].clientX,e="clientY"in t?t.clientY:t.touches[0].clientY;for(const o of this.buttons)if(this.isInside(s,e,o)){o.action();break}}handleDocumentClick(t){if(!this.popupOpen)return;const s=t.target;if(this.canvas.contains(s))return;const e=["solvePopup","tutorialPopup","settingsPopup","mazePopup"];for(const o of e){const n=document.getElementById(o);if(n&&!n.contains(s)){this.closeCurrentPopup();break}}}resizeToolbar(){const t=this.isMobile;this.isMobile=this.checkIfMobile(),t!==this.isMobile?(this.removeEventListeners(),this.removeCanvas(),this.setupCanvas(),this.addEventListeners()):(this.canvas.width=this.isMobile?window.innerWidth:50,this.canvas.height=this.isMobile?50:window.innerHeight),this.drawToolbar()}removeCanvas(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}isInside(t,s,e){return t>=e.x&&t<=e.x+e.width&&s>=e.y&&s<=e.y+e.height}togglePopup(t){this.currentPopup&&this.currentPopup.id===`${t}Popup`?this.closePopup(t):(this.closeCurrentPopup(),this.showPopup(t))}showPopup(t){switch(this.popupOpen=!0,t){case"solve":Pt(this);break;case"tutorial":Ot(this);break;case"settings":St(this);break;case"maze":Lt(this);break}}createPopupContainer(t,s){const e=document.createElement("div");e.id=t,e.className="toolbar-popup",e.style.setProperty("--toolbar-popup-top",this.isMobile?"50px":"0"),e.style.setProperty("--toolbar-popup-left",this.isMobile?"50%":"238px"),document.body.appendChild(e);const o=document.createElement("canvas");o.width=370,o.height=4e3,e.appendChild(o);const n=document.createElement("h3");return n.className="toolbar-popup__title",n.textContent=s,e.appendChild(n),this.addCloseIcon(),this.currentPopup=e,e}addCloseIcon(){this.currentCloseIcon&&document.body.removeChild(this.currentCloseIcon);const t=new Image;t.src="/MazeSolver3D/icon/close.png",t.className="toolbar-popup__close",t.style.setProperty("--toolbar-close-top",this.isMobile?"56px":"10px"),t.style.setProperty("--toolbar-close-left",this.isMobile?"calc(50% + 162px)":"400px"),t.addEventListener("click",()=>this.closeCurrentPopup()),document.body.appendChild(t),this.currentCloseIcon=t}closePopup(t){const s=document.getElementById(`${t}Popup`);s&&s.parentNode&&s.parentNode.removeChild(s),this.currentCloseIcon&&this.currentCloseIcon.parentNode&&(this.currentCloseIcon.parentNode.removeChild(this.currentCloseIcon),this.currentCloseIcon=null),document.querySelectorAll(".popup-input").forEach(o=>{var n;return(n=o.parentElement)==null?void 0:n.removeChild(o)}),this.popupOpen=!1,this.currentPopup=null}closeCurrentPopup(){this.currentPopup&&this.currentPopup.parentNode&&(this.currentPopup.parentNode.removeChild(this.currentPopup),this.currentPopup=null),this.currentCloseIcon&&this.currentCloseIcon.parentNode&&(this.currentCloseIcon.parentNode.removeChild(this.currentCloseIcon),this.currentCloseIcon=null),this.popupOpen=!1}destroy(){this.removeEventListeners(),this.removeCanvas(),this.closeCurrentPopup(),this.imageCache.clear(),this.buttons=[]}}class Dt{constructor(t,s={}){a(this,"gui");a(this,"settings");a(this,"mazeController");a(this,"mobileBreakpoint");a(this,"guiScale");a(this,"autoHide");a(this,"controllers",new Map);this.mazeController=t,this.mobileBreakpoint=s.mobileBreakpoint??800,this.guiScale=s.scale??1.4,this.autoHide=s.autoHide??!0,this.settings={backgroundColor:"#999999",wallColor:"#808080",floorColor:"#C0C0C0",wallOpacity:1,floorOpacity:1,showEdges:!0,showDebug:!0,showPreview:!0},this.gui=new bt,this.initializeGUI(),this.autoHide&&this.setupResponsiveness()}initializeGUI(){this.styleGUIContainer(),this.addColorControls(),this.addOpacityControls(),this.addEdgeControl(),this.addDebugControl(),this.addPreviewControl()}styleGUIContainer(){const t=this.gui.domElement.parentElement;t&&(t.classList.add("scaled-gui"),Object.assign(t.style,{zIndex:"1000",right:"-20px",transformOrigin:"top right",transform:`scale(${this.guiScale})`}))}addColorControls(){const t=this.gui.addColor(this.settings,"backgroundColor");t.onChange(o=>{const n=this.mazeController.getRenderer();n&&(n.setClearColor(o),this.mazeController.requestRender())}),this.controllers.set("backgroundColor",t);const s=this.gui.addColor(this.settings,"wallColor");s.onChange(o=>{this.mazeController.updateWallColor(o)}),this.controllers.set("wallColor",s);const e=this.gui.addColor(this.settings,"floorColor");e.onChange(o=>{this.mazeController.updateFloorColor(o)}),this.controllers.set("floorColor",e)}addOpacityControls(){const t=this.gui.add(this.settings,"wallOpacity",0,1,.01);t.onChange(e=>{this.mazeController.updateWallOpacity(e)}),this.controllers.set("wallOpacity",t);const s=this.gui.add(this.settings,"floorOpacity",0,1,.01);s.onChange(e=>{this.mazeController.updateFloorOpacity(e)}),this.controllers.set("floorOpacity",s)}addEdgeControl(){const t=this.gui.add(this.settings,"showEdges");t.onChange(s=>{this.mazeController.toggleEdges(s)}),this.controllers.set("showEdges",t)}addDebugControl(){const t=this.gui.add(this.settings,"showDebug");t.onChange(s=>{this.mazeController.setDebugOverlayVisible(s)}),this.controllers.set("showDebug",t)}addPreviewControl(){const t=this.gui.add(this.settings,"showPreview");t.onChange(s=>{this.mazeController.setPreviewVisible(s)}),this.controllers.set("showPreview",t)}setupResponsiveness(){this.updateGUIVisibility(),window.addEventListener("resize",()=>this.updateGUIVisibility())}updateGUIVisibility(){if(!this.gui.domElement)return;const t=window.innerWidth>this.mobileBreakpoint;this.gui.domElement.style.display=t?"block":"none"}checkWindowSize(){this.autoHide&&this.updateGUIVisibility()}updateSetting(t,s){this.settings[t]=s;const e=this.controllers.get(t);e&&e.updateDisplay&&e.updateDisplay()}setVisible(t){this.gui.domElement&&(this.gui.domElement.style.display=t?"block":"none")}destroy(){if(this.controllers.clear(),this.gui&&this.gui.domElement){const t=this.gui.domElement.parentElement;t&&t.parentElement&&t.parentElement.removeChild(t)}}}class Rt{constructor(t={}){a(this,"container");a(this,"titleBar");a(this,"canvas");a(this,"ctx");a(this,"closeButton");a(this,"legend");a(this,"isDragging",!1);a(this,"dragStartX",0);a(this,"dragStartY",0);a(this,"windowX",0);a(this,"windowY",0);a(this,"width");a(this,"height");a(this,"canvasWidth",256);a(this,"canvasHeight",256);a(this,"isVisible",!0);a(this,"mazeData",null);this.width=t.width??300,this.height=t.height??320;const s=20,e=Math.max(s,window.innerWidth-this.width-s),o=Math.max(s,window.innerHeight-this.height-s);this.windowX=t.initialX??e,this.windowY=t.initialY??o,this.container=document.createElement("div"),this.container.className="preview-window",this.container.style.width=`${this.width}px`,this.container.style.height=`${this.height}px`,this.container.style.left=`${this.windowX}px`,this.container.style.top=`${this.windowY}px`,this.titleBar=document.createElement("div"),this.titleBar.className="preview-titlebar",this.titleBar.textContent=t.title??"Preview",this.closeButton=document.createElement("button"),this.closeButton.className="preview-close-btn",this.closeButton.innerHTML="Ã—",this.legend=document.createElement("div"),this.legend.className="preview-legend",this.legend.innerHTML='<span class="preview-legend-item"><i class="preview-swatch wall"></i>Wall</span><span class="preview-legend-item"><i class="preview-swatch path"></i>Path</span>',this.canvas=document.createElement("canvas"),this.canvas.className="preview-canvas",this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight;const n=this.canvas.getContext("2d");if(!n)throw new Error("Could not get 2D context");this.ctx=n,this.titleBar.appendChild(this.closeButton),this.container.appendChild(this.titleBar),this.container.appendChild(this.legend),this.container.appendChild(this.canvas),document.body.appendChild(this.container),this.setupEventListeners(),this.render()}setupEventListeners(){this.closeButton.addEventListener("click",t=>{t.stopPropagation(),this.hide()}),this.titleBar.addEventListener("mousedown",t=>this.onMouseDown(t)),document.addEventListener("mousemove",t=>this.onMouseMove(t)),document.addEventListener("mouseup",()=>this.onMouseUp()),this.titleBar.addEventListener("selectstart",t=>t.preventDefault())}onMouseDown(t){t.target!==this.closeButton&&(this.isDragging=!0,this.dragStartX=t.clientX-this.windowX,this.dragStartY=t.clientY-this.windowY,this.container.classList.add("dragging"))}onMouseMove(t){this.isDragging&&(this.windowX=t.clientX-this.dragStartX,this.windowY=t.clientY-this.dragStartY,this.windowX=Math.max(0,Math.min(this.windowX,window.innerWidth-this.width)),this.windowY=Math.max(0,Math.min(this.windowY,window.innerHeight-this.height)),this.container.style.left=`${this.windowX}px`,this.container.style.top=`${this.windowY}px`)}onMouseUp(){this.isDragging=!1,this.container.classList.remove("dragging")}updateMaze(t){this.mazeData=t,this.render()}render(){if(this.ctx.fillStyle="#2a2a2a",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),!this.mazeData||this.mazeData.length===0)return;const t=this.mazeData.length,s=this.mazeData[0].length,e=this.canvasWidth/s,o=this.canvasHeight/t,n=Math.min(e,o),l=(this.canvasWidth-n*s)/2,h=(this.canvasHeight-n*t)/2;for(let d=0;d<t;d++)for(let m=0;m<s;m++){const g=l+m*n,f=h+(t-1-d)*n;this.mazeData[d][m]===1?this.ctx.fillStyle="#808080":this.ctx.fillStyle="#c0c0c0",this.ctx.fillRect(g,f,n,n),this.ctx.strokeStyle="#1a1a1a",this.ctx.lineWidth=1,this.ctx.strokeRect(g,f,n,n)}}show(){this.isVisible=!0,this.container.style.display="block"}hide(){this.isVisible=!1,this.container.style.display="none"}toggle(){this.isVisible?this.hide():this.show()}isWindowVisible(){return this.isVisible}handleWindowResize(){const t=Math.max(0,window.innerWidth-this.width),s=Math.max(0,window.innerHeight-this.height);this.windowX=Math.max(0,Math.min(this.windowX,t)),this.windowY=Math.max(0,Math.min(this.windowY,s)),this.container.style.left=`${this.windowX}px`,this.container.style.top=`${this.windowY}px`}destroy(){this.container.remove()}}class Tt{constructor(){a(this,"canvas");a(this,"toolbar");a(this,"maze");a(this,"guiController");a(this,"previewWindow");a(this,"resizeHandler");a(this,"debugOverlay",null);a(this,"debugRafId",null);a(this,"debugLastUpdate",0);a(this,"debugLastRenderCount",0);a(this,"debugUpdateIntervalMs",250);a(this,"renderCount",0);a(this,"renderListener");a(this,"isDebugOverlayVisible",!0);a(this,"isPreviewVisible",!0);a(this,"mobileBreakpoint",800);if(this.canvas=document.getElementById("mazeCanvas"),!this.canvas)throw new Error('Canvas element "mazeCanvas" not found');this.toolbar=new xt,this.maze=this.createInitialMaze(),this.guiController=new Dt(this,{scale:1.4,mobileBreakpoint:this.mobileBreakpoint,autoHide:!0});const t=window.innerWidth<=this.mobileBreakpoint;this.isDebugOverlayVisible=!t,this.isPreviewVisible=!t,this.guiController.updateSetting("showDebug",this.isDebugOverlayVisible),this.guiController.updateSetting("showPreview",this.isPreviewVisible),this.previewWindow=new Rt({title:"Preview",width:300,height:320}),this.renderListener=()=>{this.renderCount+=1},this.maze.addRenderListener(this.renderListener),this.setupDebugOverlay(),this.setDebugOverlayVisible(this.isDebugOverlayVisible),this.setPreviewVisible(this.isPreviewVisible),this.getRenderer().setClearColor(this.guiController.settings.backgroundColor),this.updatePreview(),this.resizeHandler=()=>this.onWindowResize(),window.addEventListener("resize",this.resizeHandler),window.addEventListener("keydown",s=>{(s.key==="p"||s.key==="P")&&this.previewWindow.toggle()})}createInitialMaze(){const t=[[[1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,1,0,0,0,0,1],[1,0,1,1,1,0,1,0,1,1,0,1],[1,0,1,0,0,0,0,0,1,0,0,1],[1,0,1,0,1,1,1,1,1,1,0,1],[1,0,0,0,1,0,0,0,0,0,0,1],[1,1,1,0,1,0,1,1,1,1,1,1],[1,0,0,0,1,0,1,0,0,0,0,1],[1,0,1,1,1,0,1,0,1,1,0,1],[1,0,0,0,0,0,1,0,1,0,0,1],[1,0,1,1,1,1,1,0,1,1,0,1],[0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]]];return new Ie(this.canvas,t)}onWindowResize(){this.toolbar.resizeToolbar(),this.maze.resize(),this.guiController.checkWindowSize(),this.previewWindow.handleWindowResize();const t=window.innerWidth<=this.mobileBreakpoint,s=!t,e=!t;this.isDebugOverlayVisible!==s&&(this.setDebugOverlayVisible(s),this.guiController.updateSetting("showDebug",s)),this.isPreviewVisible!==e&&(this.setPreviewVisible(e),this.guiController.updateSetting("showPreview",e))}updateMaze(t,s=!1){this.maze.removeRenderListener(this.renderListener),this.maze.destroy(),s?this.maze=new zt(this.canvas,t):this.maze=new Ie(this.canvas,t),this.applyGUISettings(),this.maze.addRenderListener(this.renderListener),this.updatePreview()}updatePreview(){const t=this.maze.maze;t&&t.length>0&&this.previewWindow.updateMaze(t[0])}applyGUISettings(){const t=this.getRenderer();t&&(t.setClearColor(this.guiController.settings.backgroundColor),this.requestRender())}createMultiLayerMaze(){const t=[[[1,0,1,1,1,1],[1,0,0,1,0,1],[1,1,0,0,0,1],[1,0,0,0,0,1],[1,1,1,1,1,1]],[[1,0,1,1,1,1],[1,0,0,1,0,1],[1,0,0,1,1,1],[1,0,0,0,0,1],[1,1,1,1,1,1]]];this.updateMaze(t,!0)}createSingleLayerMaze(){const t=[[[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,1,1,1,1]]];this.updateMaze(t,!1)}togglePreview(){this.previewWindow.toggle()}getRenderer(){return this.maze.getRenderer()}updateWallColor(t){this.maze.updateWallColor(t)}updateFloorColor(t){this.maze.updateFloorColor(t)}updateWallOpacity(t){this.maze.updateWallOpacity(t)}updateFloorOpacity(t){this.maze.updateFloorOpacity(t)}toggleEdges(t){this.maze.toggleEdges(t)}requestRender(){this.maze.requestRender()}destroy(){window.removeEventListener("resize",this.resizeHandler),this.maze.destroy(),this.guiController.destroy(),this.previewWindow.destroy(),this.stopDebugLoop(),this.debugOverlay&&this.debugOverlay.parentNode&&this.debugOverlay.parentNode.removeChild(this.debugOverlay)}setDebugOverlayVisible(t){this.isDebugOverlayVisible=t,this.debugOverlay&&(this.debugOverlay.style.display=t?"block":"none"),t?this.startDebugLoop():this.stopDebugLoop()}setPreviewVisible(t){this.isPreviewVisible=t,t?this.previewWindow.show():this.previewWindow.hide()}setupDebugOverlay(){this.renderCount=0;const t=document.createElement("div");t.id="debug-overlay",Object.assign(t.style,{position:"fixed",top:"8px",left:"58px",padding:"6px 8px",background:"rgba(0, 0, 0, 0.6)",color:"#e6e6e6",fontFamily:"monospace",fontSize:"12px",borderRadius:"4px",zIndex:"1000",pointerEvents:"none",whiteSpace:"pre"}),document.body.appendChild(t),this.debugOverlay=t,this.startDebugLoop()}startDebugLoop(){if(this.debugRafId!==null)return;this.debugLastUpdate=performance.now(),this.debugLastRenderCount=this.renderCount;const t=s=>{if(!this.debugOverlay){this.debugRafId=null;return}if(s-this.debugLastUpdate>=this.debugUpdateIntervalMs){const e=(s-this.debugLastUpdate)/1e3,o=this.renderCount-this.debugLastRenderCount,n=e>0?o/e:0,l=o>0&&e>0?e*1e3/o:0;this.debugOverlay.textContent=`FPS: ${n.toFixed(1)}
Frame: ${l.toFixed(2)} ms`,this.debugLastUpdate=s,this.debugLastRenderCount=this.renderCount}this.debugRafId=window.requestAnimationFrame(t)};this.debugRafId=window.requestAnimationFrame(t)}stopDebugLoop(){this.debugRafId!==null&&(window.cancelAnimationFrame(this.debugRafId),this.debugRafId=null)}}let V=null;window.onload=()=>{try{V=new Tt,window.mazeApp=V}catch(u){console.error("Failed to initialize application:",u)}};window.onbeforeunload=()=>{V&&(V.destroy(),V=null)};
